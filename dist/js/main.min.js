const formularioBusca=document.getElementById("formularioBusca"),formularioCadastro=document.getElementById("formularioCadastro"),formularioObservacao=document.getElementById("formularioObservacao"),formularioObservacaoEdicao=document.getElementById("formularioObservacaoEdicao"),pagina=window.location.pathname,socket=io();var quantidadeImagemPre=0,quantidadeImagemPos=0;function AcessarOrdem(){var e=localStorage.getItem("numeroOrdem");window.location="ordem.html?numero="+e}function CadastrarOrdemBuscada(){var e=localStorage.getItem("numeroOrdem");socket.emit("cadastro",e),socket.on("sucessoCadastro",function(){AcessarOrdem()})}if("/index.html"==pagina&&(formularioBusca.addEventListener("submit",function(e){e.preventDefault();e=e.target.elements.numeroBusca.value;0==String(e).length||4<String(e).length||e<=0?document.getElementById("PopUpErroBuscaIntervalo").style.display="flex":(localStorage.setItem("numeroOrdem",e),socket.emit("busca",e))}),socket.on("sucessoBusca",function(e){e?(numeroOrdem=localStorage.getItem("numeroOrdem"),AcessarOrdem()):document.getElementById("PopUpErroBusca").style.display="flex"})),"/cadastro-ordem.html"==pagina&&(formularioCadastro.addEventListener("submit",function(e){e.preventDefault();e=e.target.elements.numeroCadastro.value;0==String(e).length||e<=0||4<String(e).length?document.getElementById("PopUpErroBuscaIntervalo").style.display="flex":(localStorage.setItem("numeroOrdem",e),socket.emit("cadastro",e))}),socket.on("sucessoCadastro",function(e){e?document.getElementById("PopUpCadastro").style.display="flex":document.getElementById("PopUpErroCadastroExiste").style.display="flex"})),"/ordem.html"!==pagina&&localStorage.setItem("statusObservacao","desatualizada"),"/ordem.html"==pagina){let e=localStorage.getItem("numeroOrdem"),a=localStorage.getItem("observacao"),t=localStorage.getItem("statusObservacao");document.getElementById("conteudoObservacao").innerHTML=a,document.getElementById("TituloOrdem").innerHTML="ordem #"+e,socket.emit("conferirObservacao",e),"atualizada"==t&&null==a&&(document.getElementById("LinkOrdem").innerHTML="adicionar observação");let o=document.getElementById("enviarImagemPre"),n=document.getElementById("enviarImagemPos");o.addEventListener("change",function(){CriarItemImagem(0);let a=document.getElementById("imagemPre"+String(quantidadeImagemPre));var t=this.files[0];if(t){const e=new FileReader;e.addEventListener("load",function(){a.setAttribute("src",this.result)}),e.readAsDataURL(t)}});n=document.getElementById("enviarImagemPos");n.addEventListener("change",function(){CriarItemImagem(1);let a=document.getElementById("imagemPos"+String(quantidadeImagemPos));var t=this.files[0];if(t){const e=new FileReader;e.addEventListener("load",function(){a.setAttribute("src",this.result)}),e.readAsDataURL(t)}}),formularioObservacao.addEventListener("submit",function(e){e.preventDefault();var a=localStorage.getItem("numeroOrdem"),e=e.target.elements.inputObservacao.value;255<e.length?(document.getElementById("PopUpObservacaoVazia").style.display="none",document.getElementById("PopUpErroEdicaoObservacao").style.display="flex"):e.length<=0?(localStorage.removeItem("observacao"),socket.emit("alteracaoObservacao",null,a)):(localStorage.setItem("statusObservacao","desatualizada"),socket.emit("alteracaoObservacao",e,a))}),formularioObservacaoEdicao.addEventListener("submit",function(e){e.preventDefault();var a=localStorage.getItem("numeroOrdem"),e=e.target.elements.inputObservacao.value;localStorage.setItem("observacao",e),255<e.length?(document.getElementById("PopUpEdicaoObservacao").style.display="none",document.getElementById("PopUpErroEdicaoObservacao").style.display="flex"):e.length<=0?(localStorage.removeItem("observacao"),socket.emit("alteracaoObservacao",null,a)):(localStorage.removeItem("observacao"),localStorage.setItem("statusObservacao","desatualizada"),socket.emit("alteracaoObservacao",e,a))}),socket.on("resultadoAlteracaoObservacao",function(e){e?location.reload():(document.getElementById("PopUpEdicaoObservacao").style.display="none",document.getElementById("PopUpErroEdicaoObservacao").style.display="flex")}),socket.on("sucessoCadastro",function(e){e?document.getElementById("PopUpCadastro").style.display="flex":document.getElementById("PopUpErroCadastroExiste").style.display="flex"}),socket.on("sucessoExclusao",function(e){e?paraIndex():document.getElementById("PopUpErroExclusaoOrdem").style.display="flex"}),socket.on("temObservacao",function(e){localStorage.getItem("statusObservacao");null!==e?localStorage.setItem("observacao",e):localStorage.removeItem("observacao"),"desatualizada"==localStorage.getItem("statusObservacao")&&(localStorage.setItem("statusObservacao","atualizada"),location.reload())}),socket.on("imagemVolta",function(e){var a=new Image,a="data:image/png;base64,"+e;document.getElementById("imagemPopUp").setAttribute("src",a)})}function AcessarObservacao(){null==localStorage.getItem("observacao")?document.getElementById("PopUpObservacaoVazia").style.display="flex":document.getElementById("PopUpObservacaoPreenchida").style.display="flex"}function ExibirConfirmacaoAlteracaoObservacao(){document.getElementById("PopUpEdicaoObservacao").style.display="none",document.getElementById("PopUpConfirmacaoAlteracao").style.display="flex"}function ConfirmarEdicaoObservacao(){var e,a=evento.target.elements.inputObservacao.value;255<a.length?(document.getElementById("PopUpEdicaoObservacao").style.display="none",document.getElementById("PopUpErroEdicaoObservacao").style.display="flex"):(e=localStorage.getItem("numeroOrdem"),localStorage.removeItem("observacao"),socket.emit("alteracaoObservacao",a,e))}function ExibirConfirmacaoExclusaoOrdem(){document.getElementById("PopUpExclusao").style.display="flex"}function ExcluirOrdem(){var e=localStorage.getItem("numeroOrdem");socket.emit("exclusao",e)}function CriarItemImagem(e){if(e)if(quantidadeImagemPos<8){7==quantidadeImagemPos&&(document.getElementById("inputImagemPosExecucao").style.display="none"),++quantidadeImagemPos;let e=document.createElement("div"),a=document.createElement("div"),t=document.createElement("img"),o=document.createElement("i");e.className="system__order-details__image-grid__picture",a.className="system__order-details__image-grid__picture__remove";var n="imagemPosQuadro"+String(quantidadeImagemPos);e.addEventListener("click",function(e){AmpliarImagem(n),e.preventDefault()}),a.addEventListener("click",function(e){RemoverImagem(n,1,0),e.preventDefault()}),t.setAttribute("id","imagemPos"+String(quantidadeImagemPos)),e.setAttribute("id","imagemPosQuadro"+String(quantidadeImagemPos)),o.className="fas",o.classList.add("fa-times"),a.appendChild(o),e.appendChild(a),e.appendChild(t),document.querySelector(".posExecucao").appendChild(e)}else console.log("imagemPos lotada");else if(quantidadeImagemPre<8){7==quantidadeImagemPre&&(document.getElementById("inputImagemPreExecucao").style.display="none"),++quantidadeImagemPre,console.log(quantidadeImagemPre);let e=document.createElement("div"),a=document.createElement("div"),t=document.createElement("img"),o=document.createElement("i");a.className="system__order-details__image-grid__picture__remove",t.setAttribute("id","imagemPre"+String(quantidadeImagemPre));var m="imagemPreQuadro"+String(quantidadeImagemPre);e.className="system__order-details__image-grid__picture",t.addEventListener("click",function(e){AmpliarImagem(m),e.preventDefault()}),a.addEventListener("click",function(e){RemoverImagem(m,0,0),e.preventDefault()}),e.setAttribute("id","imagemPreQuadro"+String(quantidadeImagemPre)),o.className="fas",o.classList.add("fa-times"),a.appendChild(o),e.appendChild(a),e.appendChild(t),document.querySelector(".preExecucao").appendChild(e)}else console.log("imagemPre lotada")}function AmpliarImagem(e){e=document.getElementById(String(e)).src;console.log(e);let a=document.getElementById("imagemPopUp");a.setAttribute("src",e),document.getElementById("PopUpImagem").style.display="flex"}function RemoverImagem(e,a,t){t?(a?(console.log(quantidadeImagemPos),document.getElementById(e).remove(),quantidadeImagemPos--,console.log(quantidadeImagemPos)):(console.log(quantidadeImagemPre),document.getElementById(e).remove(),quantidadeImagemPre--,console.log(quantidadeImagemPre)),localStorage.setItem("primeiraVez",1),ExibirBotaoAdicaoImagem(a)):(localStorage.setItem("idImagem",e),localStorage.setItem("imagemPos",a),document.getElementById("PopUpExclusaoImagem").style.display="flex")}function ExibirBotaoAdicaoImagem(e){var a=localStorage.getItem("primeiraVez");document.getElementById("inputImagemPreExecucao").style.display="block",a&&(localStorage.removeItem("primeiraVez"),setTimeout(ExibirBotaoAdicaoImagem,16))}function ConfirmarRemocaoImagem(){var e=localStorage.getItem("imagemPos");RemoverImagem(localStorage.getItem("idImagem"),e,1),fecharPopUp(),localStorage.removeItem("imagemPos"),localStorage.removeItem("idImagem")}window.addEventListener("keydown",function(e){void 0!==e.key&&("Enter"==e.key&&document.activeElement.click(),"Escape"==e.key&&fecharPopUp(),"F1"==e.key&&(e.preventDefault(),abrirPainelAjuda()))});var isPainelAjudaAberto=!1,guiaAberto="nenhum";function paraIndex(){window.location="index.html"}function paraCadastroOrdem(){window.location="cadastro-ordem.html"}function abrirPainelAjuda(){isPainelAjudaAberto=isPainelAjudaAberto?"nenhum"!==guiaAberto?("consulta"==guiaAberto?document.getElementById("AjudaConsulta").style.display="none":"cadastro"==guiaAberto?document.getElementById("AjudaCadastro").style.display="none":"alteracao"==guiaAberto?document.getElementById("AjudaAlteracao").style.display="none":"adicaoImagem"==guiaAberto?document.getElementById("AjudaAdicaoImagem").style.display="none":"remocaoImagem"==guiaAberto?document.getElementById("AjudaRemocaoImagem").style.display="none":"extra"==guiaAberto&&(document.getElementById("AjudaExtra").style.display="none"),document.querySelector(".modal-ajuda__content__items").style.display="block",guiaAberto="nenhum",!0):!(document.querySelector(".modal-ajuda").style.display="none"):(document.querySelector(".modal-ajuda").style.display="flex",document.querySelector(".modal-ajuda__content__items").style.display="block",!0)}function abrirItemAjuda(e){document.querySelector(".modal-ajuda__content__items").style.display="none","consulta"==e?(document.getElementById("AjudaConsulta").style.display="block",guiaAberto="consulta"):"cadastro"==e?(document.getElementById("AjudaCadastro").style.display="block",guiaAberto="cadastro"):"alteracao"==e?(document.getElementById("AjudaAlteracao").style.display="block",guiaAberto="alteracao"):"adicaoImagem"==e?(document.getElementById("AjudaAdicaoImagem").style.display="block",guiaAberto="adicaoImagem"):"remocaoImagem"==e?(document.getElementById("AjudaRemocaoImagem").style.display="block",guiaAberto="remocaoImagem"):"extra"==e&&(document.getElementById("AjudaExtra").style.display="block",guiaAberto="extra")}function fecharPopUp(){isPainelAjudaAberto&&(document.querySelector(".modal-ajuda").style.display="none","consulta"==guiaAberto?document.getElementById("AjudaConsulta").style.display="none":"cadastro"==guiaAberto?document.getElementById("AjudaCadastro").style.display="none":"alteracao"==guiaAberto?document.getElementById("AjudaAlteracao").style.display="none":"adicaoImagem"==guiaAberto?document.getElementById("AjudaAdicaoImagem").style.display="none":"remocaoImagem"==guiaAberto?document.getElementById("AjudaRemocaoImagem").style.display="none":"extra"==guiaAberto&&(document.getElementById("AjudaExtra").style.display="none"),isPainelAjudaAberto=!1,guiaAberto="nenhum"),"/cadastro-ordem.html"==pagina&&(document.getElementById("PopUpCadastro").style.display="none",document.getElementById("PopUpErroCadastroExiste").style.display="none",document.getElementById("PopUpErroCadastroMaior").style.display="none"),"/index.html"!=pagina&&"/resultados-busca.html"!=pagina||(document.getElementById("PopUpErroBusca").style.display="none",document.getElementById("PopUpErroBuscaIntervalo").style.display="none"),"/ordem.html"==pagina&&(document.getElementById("PopUpExclusao").style.display="none",document.getElementById("PopUpObservacaoVazia").style.display="none",document.getElementById("PopUpObservacaoPreenchida").style.display="none",document.getElementById("PopUpEdicaoObservacao").style.display="none",document.getElementById("PopUpConfirmacaoAlteracao").style.display="none",document.getElementById("PopUpExclusaoImagem").style.display="none",document.getElementById("PopUpImagem").style.display="none",document.getElementById("PopUpErroEdicaoObservacao").style.display="none")}function AbrirPopUpCadastro(){document.getElementById("PopUpCadastro").style.display="flex"}function AbrirPopUpEdicaoObservacao(){var e=localStorage.getItem("observacao");document.getElementById("PopUpObservacaoPreenchida").style.display="none",document.getElementById("PopUpEdicaoObservacao").style.display="flex",document.querySelector(".observacao-preenchida").value=e}